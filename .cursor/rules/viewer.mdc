---
description: Writing the viewer/inspector/trajectory viewer
globs:
alwaysApply: false
---

You are building a trajectory viewer for an AI agent benchmark that pits
two AI agent in a round-based game against each other.

## Framework notes

* Write a python server using flask
* As much output as possible should be formatted uses jinja templates
* JS should be kept to a minimum
* Your input is a game folder (described below)
* Use clean modern CSS, but don't go too crazy, simplicity is key
* CSS and JS should be in separate static files, not inline in templates
* **NEVER use inline JavaScript in HTML templates** - all JavaScript must be in separate .js files in the static/js directory
* Organize JavaScript into logical modules: clipboard.js, experiment.js, readme.js, json-editors.js, etc.
* The application consists of two main pages: the viewer and the game picker
* **Static/Frozen Version Compatibility** - The viewer supports both dynamic (Flask server) and static (frozen) versions. The frozen version is generated using `freeze_viewer.py` and uses different routes (`/game/<path>` instead of `/?folder=`). **Every feature must work in both versions**. When making changes, ensure both the `index()` route and `game_view()` route receive the same data and functionality.

### Design System & Styling

* **Consistent Section Formatting**: All main sections (Overview, Analysis, Rounds) use the same styling with consistent margins, headers, and layout
* **Color System**:
  - Success states: Bright neon green (`#00ff88`) for submitted/successful statuses. This is also the accent color.
  - Error/Warning states: Bright neon pink-red (`#ff1188`) for failed/error statuses
  - Both colors maintain similar brightness and vibrancy for visual consistency
* **Status Indicators**: Exit statuses are consistently colored across all views (overview table, detailed trajectories)
* **Section Headers**: All sections use h2 headers with icons and consistent styling (font-size: 1.5rem, accent color)
* **Responsive Layout**: Flexbox layouts that adapt from column (mobile) to row (desktop) as space allows

### Template Organization

* **Main templates**: `index.html`, `picker.html`, `no_logs.html` are in the templates root
* **Sub-templates**: All partial/include templates are organized in `templates/includes/` directory
* **Template structure**: Use Jinja includes to break down complex templates into manageable sub-templates
* **Include naming**: Sub-templates should be named descriptively (e.g., `header.html`, `folder_path.html`, `trajectory.html`)
* **Template hierarchy**: Main templates include sub-templates using `{% include 'includes/template_name.html' %}`

#### Current Include Templates

* `includes/header.html` - Navigation controls and theme toggle
* `includes/folder_path.html` - Current folder display with actions
* `includes/readme.html` - Editable readme section
* `includes/setup.html` - Agent info, metadata, and tournament log foldouts
* `includes/overview.html` - Results summary table with round navigation
* `includes/analysis.html` - Analysis section with line counting charts and data visualization
* `includes/trajectory.html` - Player trajectory display with messages, diffs, and files
* `includes/rounds.html` - Main rounds section that includes trajectories and simulation logs

## Input folder

The input folders are all subfolders of `logs/`

The input folder has the following files

* metadata.json
* tournament.log
* rounds/$i/sim_$j.log, where $i is the round and $j is the simulation number (repetition of game)
* players/$player_id/$player_id_r$i.traj.json, where $j is the round number
* players/$player_id/player.log
* Trajectory files do not exist for the last round

Here's how a `.traj.log` file looks:


```
{
  "info": {
    "exit_status": null,
    "submission": null,
    "memory": null,
    "model_stats": {
      "instance_cost": 0.0661002,
      "api_calls": 11
    }
  },
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant that can interact with a computer.\n\nYour response must contain exactly ONE bash code block with ONE command (or commands connected with && or ||).\nInclude a THOUGHT section before your command where you explain your reasoning process.\nFormat your response as shown in <format_example>.\n\n<format_example>\nYour reasoning and analysis here. Explain why you want to perform the action.\n\n```bash\nyour_command_here\n```\n</format_example>\n\nFailure to follow these rules will cause your response to be rejected.\nTo finish, issue the following command: `echo MINI_SWE_AGENT_FINAL_OUTPUT`\nwithout any other command."
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "Please solve this issue: in gitconfig, add a new alias ldc which copies the last diff ..."
        }
      ]
    },
    {
      "role": "assistant",
      "content": "THOUGHT: I need to first look at the current directory to see the gitconfig file and understand its structure. Then I'll examine the existing aliases to understand the pattern and add the new 'ldc' alias that combines 'ld' (last diff) with clipboard functionality.\n\n```bash\nls -la\n```"
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "<returncode>0</returncode>\n<output>\ntotal 1232\ndrwxr-xr-x  ..."
        }
      ]
    },
    {
      "role": "assistant",
      "content": "THOUGHT: I can see there's a `gitconfig.sh` file in the current directory. Let me examine its contents to understand the current structure and find the existing aliases, particularly looking for the 'ld' alias and any clipboard-related aliases that I need to combine.\n\n```bash\ncat gitconfig.sh\n```"
    },
  "trajectory_format": "mini-swe-agent-1"
}
```

Here's how the metadata.json file looks like:

```
{
  "name": "PvpTournament",
  "tournament_id": "PvpTournament.BattleSnake.250915203207",
  "round_stats": {
    "0": {
      "round_num": 0,
      "winner": "p2",
      "scores": {
        "p2": 10,
        "p1": 9,
        "Tie": 1
      },
      "player_stats": {
        "p2": {
          "name": "p2",
          "invalid_reason": null,
          "score": 10,
          "valid_submit": true
        },
        "p1": {
          "name": "p1",
          "invalid_reason": null,
          "score": 9,
          "valid_submit": true
        }
      }
    },
  "config": {
    "tournament": {
      "rounds": 10
    },
    "game": {
      "name": "BattleSnake",
      "sims_per_round": 1000,
      "args": {
        "width": 11,
        "height": 11,
        "browser": false
      }
    },
    "players": [
      {
        "agent": "mini",
        "name": "sonnet-4-more-prescriptive",
        "config": {
          "agent": {
            "system_template": "",
            "instance_template": "",
            "step_limit": 30,
            "cost_limit": 1.0
          },
          "model": {
            "model_name": "openai/gpt-5-mini"
          }
        }
      },
      {
        "agent": "mini",
        "name": "gpt-5-mini-default",
        "config": {
          "agent": {...},
          "model": {
            "model_name": "openai/gpt-5-mini"
          }
        }
      }
    ],
    "prompts": {
      "game_description": "..."}
  },
  "created_timestamp": 1757982727,
  "game": {
    "name": "BattleSnake",
    "config": {
      "name": "BattleSnake",
      "sims_per_round": 1000,
      "args": {
        "width": 11,
        "height": 11,
        "browser": false
      }
    },
    "game_id": "PvpTournament.BattleSnake.250915203207",
    "created_timestamp": 1757982727
  },
  "agents": [
    {
      "name": "sonnet-4-more-prescriptive",
      "player_unique_id": "38f5a945-2a14-4cfb-9a41-e3ccceb7d3e2",
      "created_timestamp": 1757982729,
      "config": {
        "agent": "mini",
        "name": "sonnet-4-more-prescriptive",
        "config": {
          "agent": {
            "system_template": "...,
            "instance_template": "...",
            "step_limit": 30,
            "cost_limit": 1.0
          },
          "model": {
            "model_name": "openai/gpt-5-mini"
          }
        }
      },
      "initial_commit_hash": "dc7bdb934a2f1bba88d19136ff5caa6ff789dda7",
      "branch_name": "PvpTournament.BattleSnake.250915203207.sonnet-4-more-prescriptive",
      "round_tags": {}
    },
    {
      "name": "gpt-5-mini-default",
      "player_unique_id": "646cdd66-7cd5-4318-988f-3858ef3bd860",
      "created_timestamp": 1757982730,
      "config": {
        "agent": "mini",
        "name": "gpt-5-mini-default",
        "config": {
          "agent": {...},
          "model": {
            "model_name": "openai/gpt-5-mini"
          }
        }
      },
      "initial_commit_hash": "dc7bdb934a2f1bba88d19136ff5caa6ff789dda7",
      "branch_name": "PvpTournament.BattleSnake.250915203207.gpt-5-mini-default",
      "round_tags": {}
    }
  ]
}
```

## Application Structure

The application has two main pages:

1. **Game Picker** (`/picker`): A hierarchical tree view of all available game sessions
2. **Trajectory Viewer** (`/`): The main viewer for a selected game session

### Navigation

* The viewer has a "Pick Game" button that navigates to the picker
* The picker shows all game sessions in a tree structure with "Open" and "Open in new tab" buttons
* Navigation between pages happens in the same tab by default

### Keyboard Shortcuts

#### Navigation Shortcuts
* `h` or `‚Üê` (Left Arrow): Navigate to previous game in the folder structure
* `l` or `‚Üí` (Right Arrow): Navigate to next game in the folder structure
* `p` (lowercase): Open game picker in same tab (from viewer)
* `P` (uppercase): Open game picker in new tab (from viewer)

#### Interface Shortcuts
* `?`: Show keyboard shortcuts help modal (available on both viewer and picker pages)
* `t` (lowercase): Toggle floating table of contents
* `Ctrl/Cmd + D`: Toggle dark/light mode
* `Ctrl/Cmd + E`: Expand all sections
* `Ctrl/Cmd + Shift + E`: Collapse all sections
* `Escape`: Close all open sections

### Keyboard Shortcuts Help Modal

Both the viewer and picker pages include a help modal accessible via the `?` button or `?` keyboard shortcut:

#### Modal Features
* **Trigger**: `?` button in header or `?` keyboard shortcut
* **Content**: Displays all available keyboard shortcuts organized by category
* **Styling**: Bootstrap modal with consistent dark theme styling
* **Dismissal**: Click outside modal, press Escape, or click close button
* **Responsive**: Adapts to mobile screens appropriately

#### Modal Content Structure
* **Navigation Shortcuts**: Game navigation (h/‚Üê, l/‚Üí, p/P)
* **Interface Shortcuts**: UI controls (?/t, Ctrl+E combinations, Escape)
* **Mouse Shortcuts**: Click behaviors and multi-click actions
* **Page-Specific Shortcuts**: Different content for viewer vs picker pages

### Floating Navigation

* **Floating Table of Contents**: A floating navigation panel that provides quick navigation (always visible by default)
  - **Go to Top button**: Smooth scroll to the top of the page
  - **Flat Navigation Structure**: Simple, flat navigation without nested sections
  - **Section Navigation**: Direct links to Overview, Analysis, and individual Round sections
  - **Round Navigation**: Direct links to each round (Round 0, Round 1, etc.) without grouping
  - **Close Button**: √ó button in the header to hide the navigation panel
  - **Keyboard Toggle**: `t` key to show/hide the navigation panel
  - **Positioning**: Fixed position in bottom-right corner
  - **Responsive Design**: Adapts to mobile screens appropriately
  - **Always Visible**: Panel is expanded by default (no toggle button required)

### Mouse Navigation

* **Left-click in checkbox column**: Toggle checkbox selection
* **Left-click elsewhere on game row**: Navigate to viewer in same tab
* **Middle-click on game row**: Open in new tab
* **Ctrl+click or Cmd+click on game row**: Open in new tab (alternative to middle-click)
* **Drag over checkbox column**: Multi-select games by dragging over checkboxes
* **Left-click on Open button**: Navigate to viewer in same tab
* **Middle-click on Open button**: Open in new tab
* **Ctrl+click or Cmd+click on Open button**: Open in new tab (alternative to middle-click)
* **Left-click on ‚Üó button**: Always open in new tab

## Game Picker Design (`/picker`)

### Header

* **Help button**: `?` button that shows keyboard shortcuts modal (same functionality as viewer page)
* **Title**: "Pick a Game" with game controller icon
* **Description**: Brief explanation of the picker functionality

### Features

* **Hierarchical Tree Structure**: Shows all folders recursively with proper indentation
* **Game Detection**: Any folder containing `metadata.json` is considered a game folder
* **Multi-Selection Support**: Checkboxes allow selecting multiple games for batch operations
* **Batch Actions**: Action dropdown with options like "Copy pathnames" for selected games
* **Readme Display**: Shows the first line of each game's `readme.txt` file in the table
* **Folder Collapse/Expand**: Click intermediate folders to minimize/expand their contents
  - Collapsed folders show üìÇ icon and blue accent border
  - Expanded folders show üìÅ icon
  - Children of collapsed folders are hidden
* **Visual Distinction**:
  - Game folders: üéÆ icon, clickable for selection, blue accent color
  - Intermediate folders: üìÅ/üìÇ icon, clickable to collapse, muted appearance
* **Tree Indentation**: Uses spaces and tree characters (‚îî‚îÄ) to show folder hierarchy
* **Round Count Display**: Shows number of rounds for each game session
* **Model Display**: Shows full model names without truncation
* **Selection Behavior**:
  - Click in checkbox column: Toggle checkbox selection
  - Drag over checkbox column: Multi-select games by dragging
  - Click elsewhere on game row: Navigate to viewer (supports middle-click)
  - "Open" button: Navigate to viewer (supports middle-click)
  - "‚Üó" button: Always open viewer in new tab
  - "üìÅ" button: Open move/rename dialog for individual folders
* **Batch Operations**:
  - "Select All" checkbox to toggle all games
  - Styled action dropdown with custom arrow and hover effects for batch operations on selected games
  - **Copy paths**: Copies selected game paths as space-separated string to clipboard
  - **Add suffix**: Prompts user for suffix text and adds it to folder names with dot separator (e.g., `experiment1` ‚Üí `experiment1.backup`)
  - **Copy foldernames**: Copies only folder names (not full paths) as space-separated string to clipboard
  - **Move to subfolder**: Prompts user for subfolder name and moves all selected folders into it (creates subfolder if needed)

### Model Multi-Select Filter

The game picker includes a multi-select dropdown filter for models in the Models column header:

#### Functionality
* **Multi-Select Dropdown**: Click the "All Models" dropdown to open a list of all available models
* **Add/Remove Selection**: Click on a model name to add it to the selection; click again to remove it
* **Visual Indication**: Selected models are highlighted with accent color and bold text
* **Display Text**:
  - Shows "All Models" when no models are selected (displays all games)
  - Shows single model name when only one is selected
  - Shows "N models selected" when multiple models are selected
* **Clear Selection Button**: Integrated button in the dropdown that says "Clear selection" to reset the filter
* **Click Model Tags**: Clicking on model tags in the Models column also toggles that model in the filter selection
* **Intersection Filtering**: When multiple models are selected, only shows games that have ALL selected models (intersection, not union)
* **Empty Selection**: If no model is selected, it behaves the same as if all models were selected (shows all games)

#### Implementation Details
* **Dropdown Position**: Uses fixed positioning to avoid being cut off by table boundaries
* **Dynamic Positioning**: JavaScript calculates dropdown position based on button location
* **Close Behavior**: Dropdown closes when clicking outside or pressing Escape key
* **Keyboard Support**: Escape key closes the dropdown; navigation disabled while dropdown is open
* **CSS Styling**: Consistent with other filter controls, using accent colors and hover effects

### Layout

* Full-width table structure with seven columns: Select, Name, Date, Game, Rounds, Models, Action
* **Name column**: Sortable column showing the folder name with hierarchy indentation
* **Date column**: Sortable column showing creation date in YYYY-MM-DD HH:MM format (from `metadata["created_timestamp"]`)
* **Action column includes**: Open, Open in new tab (‚Üó), and Move/rename (üìÅ) buttons for each game folder
* Responsive design that adapts to mobile screens (hides some columns on mobile, including Date)
* Hover effects and visual feedback
* Base directory path display at the top
* Control bar with selection controls and action dropdown

### Sorting

* **Name column**: Click to sort alphabetically by folder path (ascending/descending toggle)
* **Date column**: Click to sort chronologically by creation timestamp (ascending/descending toggle)
* Sorting preserves intermediate folder hierarchy
* Sort indicators appear in column headers with hover effects

## Trajectory Viewer Design (`/`)

### Header

#### Navigation Controls
* **Previous/Next Game Buttons**: Navigate between games in alphabetical order within the folder structure
  - **Previous button**: Shows `h` and `‚Üê` keyboard shortcut indicators, disabled when no previous game available
  - **Next button**: Shows `l` and `‚Üí` keyboard shortcut indicators, disabled when no next game available
  - **Button styling**: Uses Bootstrap secondary button styling, similar to Pick Game button
* **"Pick Game" button**: Navigate to picker (supports middle-click for new tab) - positioned in the center between navigation buttons
  - Shows `p` keyboard shortcut indicator
  - Tooltip explains middle-click functionality
* **"‚Üó" button**: Always open picker in new tab
* **Help button**: `?` button that shows keyboard shortcuts modal (available on both viewer and picker pages)

#### Other Header Elements
* **Dark/light mode toggle button**
* **Current folder path display** with copy functionality, move/rename button, and delete button
  - **Move/Rename button**: üìÅ icon that opens a dialog for moving or renaming the experiment folder (exact same functionality as in the game picker)
  - **Delete button**: üóëÔ∏è icon with simple confirmation prompt to delete the entire experiment folder (rm -r)

### Main body

#### Readme Section

* **First section** after the header: A "Readme" section with editable text area
* Automatically loads content from `readme.txt` in the experiment folder (if it exists)
* **Autosave functionality**: Saves changes to `readme.txt` after 1 second of inactivity
* Shows status indicator: "Loading...", "Typing...", "Saving...", "Saved", "Error"
* Simple, unstyled text area for adding experiment notes and observations

#### Overall results

* At the top, we show the content of `metadata.json`
* There's a foldout that displays main.log (hidden by default)
* **Overview table**: Shows results summary with round navigation
  - **Header formatting**: Column headers show just the model/player names (e.g., "sonnet-4-more-prescriptive"), not including "Steps"
  - **Cell format**: Each player cell shows `<steps>/$<price> <exit_status>` with emphasis on performance metrics
    - Steps/price is prominent (larger, bold text)
    - Exit status is smaller and secondary
    - Uses responsive flexbox layout (side-by-side on desktop, stacked on mobile)
  - **Status coloring**: Exit statuses use consistent color scheme (green for "Submitted", neon red for errors)
  - **Navigation buttons**: Each row includes a button to jump to the specific round details
* **All Logs section**: Shows all available log files with individual foldouts and scroll containers
  - **tournament.log**: Tournament-level logging
  - **game.log**: Game-specific logging
  - **everything.log**: Combined comprehensive logging
  - **players/p1/player.log, players/p2/player.log**: Individual player logs for each player
  - Each log foldout includes "Copy path" and "Download" buttons and has its own scroll container with max-height of 500px for large logs
  - Logs are displayed in a dedicated section with proper styling and scrollbars

#### Analysis Section

* **Line Counting Analysis**: Interactive charts showing code evolution over time
  - File selector dropdown to choose which file to analyze
  - Chart.js-powered line charts showing changes across rounds
  - Data visualization for understanding code development patterns
* **Matrix Analysis**: Show "self-play" matrix analysis
* **Consistent Styling**: Uses same section formatting as Overview and Rounds sections
* **Foldout Structure**: Analysis content is contained in collapsible foldouts for space efficiency

##### Matrix Analysis

If a file `matrix.json` exists, load it. It looks like this:

```
{
  "name": "MatrixEvaluator",
  "pvp_output_dir": "logs/klieret/real_games/PvpTournament.BattleSnake.250918193642.sonnet_vs_o3",
  "p1_name": "sonnet-4",
  "p2_name": "o3",
  "rounds": 11,
  "n_repetitions": 1,
  "created_timestamp": 1758572722,
  "matrices": {
    "sonnet-4_vs_sonnet-4": {
      "0": {
        "1": {
          "round_num": "e2513f264ac04a019c25982d2b03b3bb",
          "winner": "sonnet-4_2",
          "scores": {
            "sonnet-4_r0": 1,
            "sonnet-4_r1": 0.0
          },
          "player_stats": {
            "sonnet-4_r0": {
              "name": "sonnet-4_2",
              "invalid_reason": "",
              "score": 1,
              "valid_submit": true
            },
            "sonnet-4_r1": {
              "name": "sonnet-4_1",
              "invalid_reason": "",
              "score": 0.0,
              "valid_submit": true
            }
          }
        }
      },

      ...
    }
```

For this, you want to now show a dropdown with all the matrix names, e.g., "sonnet-4_vs_sonnet-4".
Visualize the matrix by always showing the scores dictionary. You always want to show it relative to the player 1 perspective,
i.e., here `sonnet-4_1`, so you would put a 0% for the 0-0 cell.
Other than that, follow the logic with the % value similar to the overall results table, i.e., you calculate
wins + 0.5 * ties / total games * 100 for the % value. All this calculation should be done in the python code.
Note that the table might be incomplete.

#### Rounds

First, show a foldout of `round_1.log`.

Then, show a foldout with the trajectory view of player 1 round 1 (see below for trajectory view)
Then, show a foldout with the content of trajectory player 1 round 1 ["submission"]
Then, show a foldout with the content of trajectory player 1 round 1 ["memory"]
Then, show a foldout with the trajectory view of player 2 round 1 (see below for trajectory view).
Then, show a foldout with the content of trajectory player 2 round 1 ["submission"]
Then, show a foldout with the content of trajectory player 2 round 1 ["memory"]

Then, show a foldout of `round_2.log`.

Then, show a foldout with the trajectory view of player 1 round 2 (see below for trajectory view)
Then, show a foldout with the trajectory view of player 2 round 2 (see below for trajectory view).
Then, show a foldout with the content of trajectory player 2 round 2 ["submission"]
Then, show a foldout with the content of trajectory player 2 round 2 ["memory"]

etc.

Note that he last round only has the `round_n.log`, but there's no more trajectories for the last one.

#### Trajectory view

This is implemented as its own jinja template (`includes/trajectory.html`) that is included by the rounds template.

The trajectory template displays:

* **Trajectory Stats**: API calls, cost, and exit status from the `info` section
  - **Exit Status Styling**: Non-"Submitted" statuses appear in bright neon red for immediate error identification
  - **Consistent Coloring**: Uses same color scheme as overview table and other status indicators
* **Messages Foldout**: All trajectory messages with role badges and content preview/expand functionality
* **Diff Foldouts**: Full diff and incremental diff sections (if available)
* **Modified Files**: Changed files during the trajectory (if available)
* **Submission**: Final submission content (if available)
* **Memory**: Memory state content (if available)

**Message Role Badges**: Each message displays a small role badge (e.g., "User #1", "Assistant #2") in the top-right corner. These badges automatically hide on hover over the message block to improve readability and allow users to see text that might be obscured by the badge.

**Content Preview**: Long message content (>5 lines) shows a preview with expand/collapse functionality to keep the interface manageable.

## Download Functionality

The trajectory viewer provides download capabilities for all files that have "Copy path" buttons (except the current folder path):

### Download Locations

* **Tournament and Game Logs**: All log files in the Overview section (tournament.log, game.log, everything.log, player logs)
* **Metadata Files**: The metadata.json file in the Setup section
* **Trajectory Files**: Individual trajectory files (.traj.json) in the Rounds section

### Implementation Details

* **Download Buttons**: Each "Copy path" button (except current folder) is accompanied by a "Download" button with a download icon
* **Server Endpoint**: `GET /download-file?path=<file_path>` serves files with proper security checks
* **Security**: Files must exist within the logs directory, be actual files (not directories), and be accessible
* **File Naming**: Downloaded files retain their original names
* **JavaScript**: Download functionality is handled by `downloadFile()` function in `clipboard.js`
* **User Feedback**: Download buttons show success/error states similar to copy buttons

### Button Styling

* **Download buttons** use the same styling as copy buttons but with download icon (`bi-download`)
* **Button classes**: `.download-btn` and `.download-btn-small` for consistent styling
* **Placement**: Download buttons appear immediately after their corresponding copy path buttons

## Multi-Select Actions Specification

The game picker includes four batch operations for selected game folders, accessible via the action dropdown:

### 1. Copy Paths (`copy-paths`)
- Copies full relative paths of selected games as space-separated string
- Example: `fuchur/experiment1 fuchur/experiment2`
- Uses modern clipboard API with execCommand fallback for non-HTTPS environments

### 2. Add Suffix (`add-suffix`)
- Prompts user for suffix text using browser's native `prompt()`
- Adds suffix with dot separator: `experiment1` ‚Üí `experiment1.backup`
- Server endpoint: `POST /rename-folders` with `action: "add-suffix"`
- Validates folder existence and prevents name conflicts
- Shows success message and refreshes page after operation

### 3. Copy Foldernames (`copy-foldernames`)
- Copies only folder names (not full paths) as space-separated string
- Example: From `fuchur/experiment1` copies just `experiment1`
- Uses modern clipboard API with execCommand fallback for non-HTTPS environments

### 4. Move to Subfolder (`move-to-subfolder`)
- Prompts user for subfolder name using browser's native `prompt()`
- Moves selected folders to new/existing subfolder in their parent directory
- Server endpoint: `POST /move-to-subfolder`
- Creates subfolder if it doesn't exist
- Validates subfolder name (no path separators)
- Shows success message and refreshes page after operation

## Individual Move/Rename Functionality

Both the game picker and trajectory viewer include move/rename functionality for individual folders:

### Move/Rename Dialog
- **Trigger**: Click the üìÅ button next to any game folder (picker) or in the folder path section (viewer)
- **Interface**: Minimal unstyled dialog with text input field
- **Behavior**:
  - Pre-fills input with current full path
  - User can edit path to rename or move folder
  - Supports moving to new directory structures
- **Keyboard shortcuts**:
  - `Escape`: Close dialog
  - `Enter`: Confirm move operation

### Move/Rename Operations
- **Server endpoint**: `POST /move-folder`
- **Path validation**: Ensures both source and target are within logs directory
- **Intermediate folders**: Creates intermediate directories if necessary
- **Conflict handling**: Prevents overwriting existing folders
- **Error handling**: Provides clear error messages for invalid operations
- **Success feedback**: Shows confirmation message and redirects to new path (in viewer) or refreshes page (in picker)

### Use Cases
- **Simple rename**: Change folder name (e.g., `experiment1` ‚Üí `experiment1_final`)
- **Move to subdirectory**: Move folder to organized structure (e.g., `experiment1` ‚Üí `completed/experiment1`)
- **Reorganize structure**: Move folders between different directory hierarchies

### Viewer-Specific Behavior
- After successful move/rename in the trajectory viewer, the user is automatically redirected to the new folder path
- The move/rename button appears in the folder path section alongside copy and delete buttons

## Navigation Implementation Details

### Game Navigation Logic
* **Navigation Order**: Games are sorted alphabetically by their folder path within the logs directory
* **Backend Function**: `get_navigation_info(selected_folder)` determines previous/next games
* **Button States**: Navigation buttons are automatically disabled when no previous/next game is available
* **URL Generation**: Supports both dynamic Flask routes (`/?folder=`) and static frozen routes (`/game/`)

### Keyboard Shortcut Implementation
* **Event Handling**: Single consolidated keyboard event listener to prevent conflicts
* **Input Field Detection**: Shortcuts are disabled when typing in input fields or textareas
* **Modal Priority**: Dialog shortcuts (Escape/Enter) take precedence when modals are open
* **Arrow Key Support**: Both letter keys (h/l) and arrow keys (‚Üê/‚Üí) work for navigation

### Button Layout
* **Header Organization**: Navigation buttons (Previous, Pick Game, Next, Help) in logical left-to-right order
* **Consistent Styling**: All buttons use Bootstrap classes with consistent kbd shortcut indicators
* **Responsive Design**: Button layout adapts appropriately on mobile devices

### Important

* Always use the player name from the metadata.json file, do not assume players are called p1, p2, etc.
